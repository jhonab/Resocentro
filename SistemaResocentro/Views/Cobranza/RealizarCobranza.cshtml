@model SistemaResocentro.ViewModel.GenerarDocumento
@{
    ViewBag.Title = "RealizarCobranza";
}

<h2>Realizar Cobranza</h2>
<style>
    body .input-group-addon {
        color: #000;
    }

    #encabezado_razonSocialReceptor, #encabezado_calleReceptor {
        text-transform: uppercase;
    }

    #encabezado_emailReceptor {
        text-transform: lowercase;
    }
</style>
<script type="text/javascript">
    $(function () {
        @if (Model != null)
        {
            if (Model.encabezado != null)
            {
                if (Model.encabezado.provinciaReceptor !=null)
                {
        <text>
        getProvincia("@Model.encabezado.provinciaReceptor", "encabezado_provinciaReceptor");;
        getDistrito("@Model.encabezado.provinciaReceptor", "@Model.encabezado.distritoReceptor", "encabezado_distritoReceptor");
        </text>

                }
            }
        }
        $("#div_sunat").height($(window).height() - 300); 
        $("#div_lista_aseguradora").attr("data-height", ($(window).height() - 350));
        $("#encabezado_rucReceptor").keypress(function () {
            if (event.which == 13) {
                $('#myModal').modal('show')
            }

        });
        $("#txtruc").keypress(function () {
            if (event.which == 13) {
                buscarAseguradora();
            }

        });

    });

    function getProvincia(sel, input) {
        var dep = $("#encabezado_departamentoReceptor").val();
        if (dep != "") {
            $.ajax({
                url: '/Herramientas/getProvincia',
                data: { dep: dep },
                dataType: "json",
                type: "POST",
                success: function (data) {
                    var items = "";
                    items += "<option value=''>- Provincia -</option>";
                    $.each(data, function (i, item) {
                        if (sel == item.Value)
                            items += "<option selected='selected' value=\"" + item.Value + "\">" + item.Text + "</option>";
                        else
                            items += "<option value=\"" + item.Value + "\">" + item.Text + "</option>";
                    });
                    $("#" + input).html(items);
                },
                error: function () {
                    toastr.error("No se cargo las provincias.", "Error", opts);
                }
            });
        }
    }

    function getDistrito(val, sel, input) {
        var dep = $("#encabezado_departamentoReceptor").val();
        var pro = $("#encabezado_provinciaReceptor").val();
        if (val != undefined)
            pro = val;
        if (dep != "" && pro != "")
            $.ajax({
                url: '/Herramientas/getDistrito',
                data: { dep: dep, pro: pro },
                dataType: "json",
                type: "POST",
                success: function (data) {
                    var items = "";
                    items += "<option value=''>- Distrito -</option>";
                    $.each(data, function (i, item) {
                        if (sel == item.Value)
                            items += "<option selected='selected' value=\"" + item.Value + "\">" + item.Text + "</option>";
                        else
                            items += "<option value=\"" + item.Value + "\">" + item.Text + "</option>";
                    });
                    $("#" + input).html(items);
                },
                error: function () {
                    toastr.error("No se cargo las provincias.", "Error", opts);
                }
            });
    }

</script>

<div class="row">
    <div class="col-md-12">
        <fieldset>

            <legend>Datos del Paciente</legend>
            <div class="row">
                <div class="col-md-6">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                @Html.DropDownListFor(model => model.encabezado.tipoDocReceptor, (SelectList)ViewBag.TipoDoc, " - Tipo Doc. -", new { @class = "form-control" })
                            </div>
                        </div>

                        <div class="col-md-8">
                            <div class="form-group input-group">
                                @Html.TextBoxFor(model => model.encabezado.rucReceptor, new { @class = "form-control ", @placeholder = "N° de Documento",@readonly="" })
                                <span class="input-group-addon" data-toggle="modal" data-target="#myModal">
                                    <i class="fa fa-search"></i>
                                </span>
                            </div>

                            <a href="#" data-toggle="modal" data-target="#sunatModal">Consultar RUC SUNAT</a>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group input-group">
                                <span class="input-group-addon">
                                    <i class="fa fa-user"></i>
                                </span>
                                @Html.TextBoxFor(model => model.encabezado.razonSocialReceptor, new { @class = "form-control ", @placeholder = "Razon  Social / Nombre Completo",@readonly="" })
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-4">
                    <div class="row">
                        @Html.HiddenFor(model=> model.encabezado.ubigeoReceptor)
                        <div class="col-md-6">
                            <div class="form-group">
                                @Html.DropDownListFor(model => model.encabezado.departamentoReceptor, (SelectList)ViewBag.Dept, " - Departamento -", new { @class = "form-control", @onchange = "getProvincia('-','encabezado_provinciaReceptor')" })
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group">
                                @Html.DropDownListFor(model => model.encabezado.provinciaReceptor, new SelectList(new List<string>()), " - Provincia -", new { @class = "form-control ", @onchange = "getDistrito('-','-','encabezado_distritoReceptor')" })
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-8">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                @Html.DropDownListFor(model => model.encabezado.distritoReceptor, new SelectList(new List<string>()), " - Distrito -", new { @class = "form-control" })
                            </div>
                        </div>

                        <div class="col-md-8">
                            <div class="form-group input-group">
                                <span class="input-group-addon">
                                    <i class="fa fa-location-arrow  "></i>
                                </span>
                                @Html.TextBoxFor(model => model.encabezado.direccionReceptor, new { @class = "form-control ", @placeholder = "Dirección" })
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group input-group">
                                <span class="input-group-addon">
                                    <i class="fa fa-at  "></i>
                                </span>
                                @Html.TextBoxFor(model => model.encabezado.emailReceptor, new { @class = "form-control ", @placeholder = "Correo" })
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group input-group">
                                <span class="input-group-addon">
                                    <i class="fa fa-mobile fa-lg"></i>
                                </span>
                                @Html.TextBoxFor(model => model.encabezado.celularReceptor, new { @class = "form-control ", @placeholder = "Celular" })
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group input-group">
                                <span class="input-group-addon">
                                    <i class="fa fa-phone "></i>
                                </span>
                                @Html.TextBoxFor(model => model.encabezado.telefonoReceptor, new { @class = "form-control ", @placeholder = "Teléfono" })
                            </div>
                        </div>
                    </div>
                </div>

            </div>

        </fieldset>
        @if (!Model.encabezado.razSocialAseguradora.ToLower().Contains("particular"))
        {
            <script type="text/javascript">
                $(function () {
                    @if (Model != null)
        {
            if (Model.encabezado != null)
            {
                if (Model.encabezado.provinciaAseguradora != null)
                {
        <text>
                    getProvincia("@Model.encabezado.provinciaAseguradora", "encabezado_provinciaAseguradora");;
                    getDistrito("@Model.encabezado.provinciaAseguradora", "@Model.encabezado.distritoAseguradora", "encabezado_distritoAseguradora");
                    </text>

                }
            }
        }
                });
            </script>
            <fieldset>

                <legend>Datos de Asegurador</legend>

                <div class="row">
                    <div class="col-md-6">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group">
                                    @Html.DropDownListFor(model => model.encabezado.tipodocAseguradora, (SelectList)ViewBag.TipoDoc, " - Tipo Doc. -", new { @class = "form-control" })
                                </div>
                            </div>

                            <div class="col-md-8">
                                <div class="form-group input-group">
                                    <span class="input-group-addon">
                                        <i class="fa fa-credit-card  "></i>
                                    </span>
                                    @Html.TextBoxFor(model => model.encabezado.rucAseguradora, new { @class = "form-control ", @placeholder = "N° de Documento" })
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group input-group">
                                    <span class="input-group-addon">
                                        <i class="fa fa-user"></i>
                                    </span>
                                    @Html.TextBoxFor(model => model.encabezado.razSocialAseguradora, new { @class = "form-control ", @placeholder = "Razon  Social / Nombre Completo" })
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    @Html.DropDownListFor(model => model.encabezado.departamentoAseguradora, (SelectList)ViewBag.Dept, " - Departamento -", new { @class = "form-control", @onchange = "getProvincia('-','encabezado_provinciaAseguradora')" })
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="form-group">
                                    @Html.DropDownListFor(model => model.encabezado.provinciaAseguradora, new SelectList(new List<string>()), " - Provincia -", new { @class = "form-control ", @onchange = "getDistrito('-','-',encabezado_distritoAseguradora)" })
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group">
                                    @Html.DropDownListFor(model => model.encabezado.distritoAseguradora, new SelectList(new List<string>()), " - Distrito -", new { @class = "form-control" })
                                </div>
                            </div>

                            <div class="col-md-8">
                                <div class="form-group input-group">
                                    <span class="input-group-addon">
                                        <i class="fa fa-location-arrow  "></i>
                                    </span>
                                    @Html.TextBoxFor(model => model.encabezado.direccionAseguradora, new { @class = "form-control ", @placeholder = "Dirección" })
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </fieldset>
        }
        <div class="col-md-6">
            <div class="row">
                <div class="col-md-6">
                    <label>TC Venta: </label>
                    @ViewBag.TCVenta
                </div>
                <div class="col-md-6">
                    <label>TC Compra: </label>
                    @ViewBag.TCCompra
                </div>

            </div>
        </div>
    </div>
</div>

<div id="div_detalle">
    <div class="row">
        <div class="col-md-12">
            <table class="table table-striped table-bordered table-hover">
                <thead>
                    <tr>
                        <th style="width:30px!important"></th>
                        <th style="display:none;"></th>
                        <th style="width:30px;vertical-align: middle;text-align:center;">
                            Cant.
                        </th>
                        <th style="vertical-align: middle;">
                            Descripción
                        </th>
                        <th style="text-align:center">
                            Valor<br />Unitario
                        </th>
                        @if (!Model.encabezado.razSocialAseguradora.ToLower().Contains("particular"))
                        {
                            <th style="text-align:center;vertical-align: middle;">
                                % Coaseguro
                            </th>
                            <th style="text-align:center;vertical-align: middle;">
                                Coaseguro
                            </th>
                        }
                        <th style="text-align:center;vertical-align: middle;">
                            Desc.<br />Cortesia
                        </th>
                        <th style="text-align:center">
                            Valor<br />Bruto
                        </th>
                        <th style="text-align:center;vertical-align: middle;">
                            IGV
                        </th>
                        <th style="text-align:center">
                            Valor<br />Venta
                        </th>

                    </tr>
                </thead>
                @foreach (var item in Model.detalle)
                {
                    <tbody>
                        <tr>
                            <td style="text-align:center">
                                <a class="btn btn-danger btn-xs" d href="#"><i class="fa fa-times"></i></a>
                            </td>
                            <td style="display:none;">@item.codigoitem</td>
                            <td style="text-align:center">@item.cantidad</td>
                            <td>@item.descripcion</td>
                            <td style="text-align:right">@item.simboloMoneda @item.valorUnitario.ToString("######0.00")</td>
                            @if (!Model.encabezado.razSocialAseguradora.ToLower().Contains("particular"))
                            {
                                <td style="text-align:center">@item.porcentajeCoaseguro%</td>
                                <td style="text-align:right">@item.simboloMoneda @item.descxCoaseguro.ToString("######0.00")</td>
                            }
                            <td style="text-align:right">@item.simboloMoneda @item.descxItem.ToString("######0.00")</td>
                            <td style="text-align:right">@item.simboloMoneda @item.valorVenta.ToString("######0.00")</td>
                            <td style="text-align:right">@item.simboloMoneda @item.igvItem.ToString("######0.00")</td>
                            <td style="text-align:right">@item.simboloMoneda @((item.totalventa).ToString("######0.00"))</td>
                        </tr>
                    </tbody>
                }
            </table>
        </div>
    </div>

    @if (!Model.encabezado.razSocialAseguradora.ToLower().Contains("particular"))
    {
        <div class="row">
            <div class="col-md-12">
                <table class="table table-striped table-bordered table-hover">
                    <thead>
                        <tr>
                            <th style="width:30px!important"></th>
                            <th style="display:none;"></th>
                            <th style="width:30px;vertical-align: middle;text-align:center;">
                                Cant.
                            </th>
                            <th style="vertical-align: middle;">
                                Descripción
                            </th>
                            <th style="text-align:center">
                                Valor<br />Unitario
                            </th>
                            <th style="text-align:center;vertical-align: middle;">
                                % Seguro
                            </th>
                            <th style="text-align:center;vertical-align: middle;">
                                Seguro
                            </th>
                            <th style="text-align:center">
                                Valor<br />Bruto
                            </th>
                            <th style="text-align:center;vertical-align: middle;">
                                IGV
                            </th>
                            <th style="text-align:center">
                                Valor<br />Venta
                            </th>

                        </tr>
                    </thead>
                    @foreach (var item in Model.detalle)
                    {
                        <tbody>
                            <tr>
                                <td style="text-align:center">
                                    <a class="btn btn-danger btn-xs" d href="#"><i class="fa fa-times"></i></a>
                                </td>
                                <td style="display:none;">@item.codigoitem</td>
                                <td style="text-align:center">@item.cantidad</td>
                                <td>@item.descripcion</td>
                                <td style="text-align:right">@item.simboloMoneda @item.valorUnitario.ToString("######0.00")</td>
                                <td style="text-align:center">@item.porcentajeSeguro%</td>
                                <td style="text-align:right">@item.simboloMoneda @item.descxSeguro.ToString("######0.00")</td>
                                <td style="text-align:right">@item.simboloMoneda @item.valorVentaSeguro.ToString("######0.00")</td>
                                <td style="text-align:right">@item.simboloMoneda @item.igvItemSeguro.ToString("######0.00")</td>
                                <td style="text-align:right">@item.simboloMoneda @((item.totalventaSeguro).ToString("######0.00"))</td>
                            </tr>
                        </tbody>
                    }
                </table>
            </div>
        </div>
    }
</div>
<script type="text/javascript">

    function buscarAseguradora() {
        var _ruc = $("#txtruc").val();
        if (_ruc != "") {
            $("#div_lista_aseguradora").load("/Cobranza/getAseguradora?ruc=" + _ruc, function (response, status, xhr) {
                if (status == "error") {
                    toastr.error('Error:\n' + xhr.status + " " + xhr.statusText, 'Error', opts);
                }
            });
        }
    }
</script>
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content ">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">Buscar RUC</h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-1">
                    </div>
                    <div class="col-md-8">
                        <div class="form-group">
                            <input type="text" id="txtruc" class="form-control" placeholder="Ingrese N° RUC" />
                        </div>
                    </div>
                    <div class="col-md-3">
                        <button class="btn btn-info" onclick="buscarAseguradora()"><i class="fa fa-search"></i></button>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12 scrollable" id="div_lista_aseguradora" data-height="150" data-scroll-position="right" data-rail-opacity="0.5" data-rail-width="20"   data-autohide="0">


                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="sunatModal" tabindex="-1" role="dialog" aria-labelledby="sunatModalLabel">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">Consultar RUC</h4>
            </div>
            <div class="modal-body">
                <iframe width="100%" id="div_sunat" src="http://www.sunat.gob.pe/cl-ti-itmrconsruc/jcrS00Alias"></iframe>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>