@{
    ViewBag.Title = "Asignación de Anestesiólogo";
}


<h2>Asignación de Anestesiólogo</h2>


<script src="~/js/Datetime/moment.js"></script>
<script src="~/js/Datetime/moment-with-locales.js"></script>
<script src="~/js/Datetime/bootstrap-datetimepicker.js"></script>
<link href="~/css/Datetime/bootstrap-datetimepicker.css" rel="stylesheet" />

<link href="~/js/datatables/datatable.css" rel="stylesheet" />
<script src="~/js/datatables/jquery.dataTables.min.js"></script>
<script src="~/js/dataTables.bootstrap.js"></script>
<style>
    table.dataTable tbody tr.selected {
        background-color: #abb9d3;
    }

    .table-hover > tbody > tr.selected:hover > td, .table-striped > tbody > tr.selected:nth-child(odd) > td {
        background-color: #abb9d3;
    }
</style>

<script type="text/javascript">
    var table;
    
    var refreshInterval;
    $(function () {
        $(".esperando").hide();

        document.oncontextmenu = false;
        $('#dtInicio').datetimepicker({
            sideBySide: true,
            locale: 'es',
            defaultDate: '@DateTime.Now.AddDays(1).ToString("MM/dd/yyyy")',
            minDate: '@DateTime.Now.ToString("MM/dd/yyyy")',
            format: 'DD/MM/YYYY'
        });
        getData();


    });
    function getData() {
        var fecha = $("#dtInicio>input").val();
        $("#div_lista").load("/AtencionCliente/ListaAsignacion?f=" + fecha, function (response, status, xhr) {
            if (status == "error") {
                var msg = "Sorry but there was an error: ";
                alert(msg + xhr.status + " " + xhr.statusText);
            }
        });



    }
    function sendCorreo() {
        $("#modalUpdateSeg").modal("show");
        $("#lblresumen").html("Se seleccionaron " + selected.length + " estudio(s)")

    }
    function selecctRow(id) {
        var index = $.inArray(id, selected);

        if (index === -1) {
            selected.push(id);
        } else {
            selected.splice(index, 1);
        }
        $('#tb_paciente tbody tr').removeClass('selected')
        table.rows().data().each(function (value, ind) {
            selected.forEach(function (val, idx) {
                if (val == table.cell(ind, 2).data())
                    $('#tb_paciente tbody tr:eq(' + ind + ')').toggleClass('selected');
            });
        });

    }
    function EnviarEmail() {
        var fecha = $("#dtInicio>input").val();
        var comentarios = $("#txtcomentarios").val();
        $.ajax({
            url: '/AtencionCliente/EnviarSedaciones',
            data: { citas: selected, f: fecha, dr: $("#cbosedador").val(),com:comentarios },
            dataType: "json",
            type: "POST",
            success: function (data) {
                selected = [];
                $("#modalUpdateSeg").modal("hide");
                $("#cbosedador").val("");
                getData();
                toastr.success("El mensaje se envió el mensaje con éxito.", "Éxito", opts);
            },
            error: function () {
                toastr.error("No se pudo obtener la data", "Error", opts);

            }
        });
    }
</script>
<div class="row">
    <div class="col-lg-12">
        <div class="col-md-6 ">
            <div class="form-group">
                <div class="col-lg-6">
                    <label class="">Fecha: </label>
                    <div class="">
                        <div id="dtInicio" class='input-group date'>
                            <input type="text" class=" form-control" />
                            <span class="input-group-addon btn-blue">
                                <span class="fa fa-calendar"></span>
                            </span>
                        </div>
                    </div>
                </div>

            </div>
        </div>
        <div class="col-md-2">
            <label style="color:#fff;" class="">: </label>
            <div>
                <button class="btn btn-info" type="button" onclick="getData()"><i class="fa fa-search fa-lg"></i>&nbsp;&nbsp;Buscar</button>
            </div>
        </div>


    </div>
</div>
<div class="esperando " style="text-align: center;color:#065d9d"><i class="fa fa-spinner fa-5x fa-spin"></i> <br />Cargando...</div>

<div class="row">
    <div class="col-md-12" id="div_lista">

    </div>
</div>



<div class="modal fade" id="modalUpdateSeg" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="modalUpdateSeg-Label" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content" id="modalUpdateSeg-body">
            <div class="modal-header modal-primary">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">Correccion de Errores</h4>
            </div>
            <div class="modal-body">
                <div class="">
                    <div class="form-group">
                        <label id="lblresumen"> </label>
                    </div>
                    <div class="form-group">
                        <label>Anestesiólogo: </label>
                        @Html.DropDownList("cbosedador", (SelectList)ViewBag.Sedadores, "- Seleccione el Anestesiólogo -", new { @class = "form-control" })
                    </div>
                    <div class="form-group">
                        <label>Comentarios Adicionales: </label>
                        <textarea id="txtcomentarios" class="form-control" rows="5"></textarea>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
                <button type="button" class="btn btn-success" onclick="EnviarEmail()">Enviar</button>
            </div>
        </div>
    </div>
</div>
