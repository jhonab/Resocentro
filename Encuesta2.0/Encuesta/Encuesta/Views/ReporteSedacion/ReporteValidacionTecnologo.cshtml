@model Encuesta.ViewModels.Reporte.ReporteViewModel
@{
    ViewBag.Title = "Reporte de Validacion de Tecnólogo";
}

<script src="~/js/plugins/dataTables/jquery.dataTables.js"></script>
<script src="~/js/plugins/dataTables/dataTables.bootstrap.js"></script>
<script src="~/js/plugins/KendoChart/kendo.all.min.js"></script>
<link href="~/css/plugins/Kendochart/kendo.dataviz.min.css" rel="stylesheet" />
<script src="~/js/plugins/morris/morris.min.js"></script>
<script src="~/js/plugins/morris/raphael.min.js"></script>
<div class="row">
    <div class="col-lg-12">
        <div class="box box-primary">
            <div class="box-header">

                <h2 class="box-title">Reporte de Validacion de Tecnólogo</h2>
            </div>
            <div class="box-body chart-responsive">


                <div class="row">
                    <div class="col-lg-6">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                Filtro de Fecha
                            </div>
                            <div class="panel-body">
                                @using (Html.BeginForm("ReporteValidacionTecnologo", "Reporte", FormMethod.Get))
                                {
                                    <script type="text/javascript">
                                        function validar() {
                                            var msj = "";
                                            if ($("#i").val() == "")
                                                msj += "- Ingrese la fecha de inicio \n";
                                            if ($("#f").val() == "")
                                                msj += "- Ingrese la fecha de termino \n";

                                            if (msj == "")
                                                return true;
                                            else {
                                                alert(msj);
                                                return false;
                                            }
                                        }
                                    </script>
                                    <div class="form-group col-lg-6">
                                        <label>Inicio:</label>
                                        <input type="date" id="i" name="i" class="form-control" />
                                    </div>
                                    <div class="form-group col-lg-6">
                                        <label>Termino:</label>
                                        <input type="date" id="f" name="f" class="form-control" />
                                    </div>

                                    <input type="submit" value="Buscar" onclick="return validar();" class="btn btn-outline btn-success" />

                                }
                            </div>

                        </div>
                    </div>
                </div>
                <div class="box box-primary">
                    <div class="box-header">
                        <h3 class="box-title">Encuestador</h3>
                    </div>
                    <div class="box-body chart-responsive">
                        <div id="chart-encuestador">
                        </div>
                    </div>
                </div>
                <div class="panel-body">
                    <script type="text/javascript">
    $(document).ready(function () {
        $('#tabla_adquisicion').dataTable();
   

        var _periode = '@Model.tecnologo.First().fecha.ToString("MMMM {0} yyyy")';
        var dataencu1 = [ @{ foreach (var item in Model.tecnologo.OrderBy(x => x.tecnologo).Select(x => x.tecnologo).Distinct().ToArray())
        {
            <text>{ name: '@item', data: [   </text>foreach (var dia in Model.tecnologo.OrderBy(x => x.fecha).Select(x => x.fecha.Day).Distinct().ToList())
            {  <text> @Model.tecnologo.Where(x => x.tecnologo == item && x.fecha.Day == dia).Count(),  </text>  }  <text>] },  </text>  
                             }
                             }
        ];
        var lstDias = [];
        @{
            foreach (var item in Model.tecnologo.OrderBy(x => x.fecha).Select(x => x.fecha.ToString("dd/MMM")).Distinct().ToArray())
            {  <text>lstDias.push('@item');  </text>  }        
            }

    $("#chart-encuestador").kendoChart({
        theme: "Metro",
        title: {
            text: "Reporte de Tecnólogos del Mes de " + _periode.replace("{0}", "del"),
        },
        legend: {
            position: "bottom"
        },
        seriesDefaults: {
            type: "line"
        },
        series: dataencu1,
        valueAxis: {
            labels: {
                format: "{0}"
            }/*, plotBands: [{
                from: 0,
                to: 10,
                color: "#c00",
                opacity: 0.3
            }]*/
        },
        categoryAxis: {
            categories: lstDias
        },
        tooltip: {
            visible: true,
            template: "   #= series.name # : #= value #  "
        }
    });


    });
                    </script>

                    <div class="panel panel-primary">
                        <div class="panel-heading">
                            Revisiones
                        </div>
                        <div class="panel-body">
                            <table class="table table-striped table-bordered table-hover" id="tabla_adquisicion">
                                <thead>
                                    <tr>
                                        <th>
                                            Revisado
                                        </th>
                                        <th>
                                            Tecnólogo
                                        </th>
                                        <th>
                                            Fecha
                                        </th>
                                        <th>
                                            Examen
                                        </th>
                                        <th>
                                            Paciente
                                        </th>
                                        <th>
                                            Mod.
                                        </th>
                                        <th>
                                            Estudio
                                        </th>
                                        <th>
                                            Equipo
                                        </th>
                                        <th>
                                            Placas
                                        </th>
                                        <th>
                                            Imagenes
                                        </th>
                                        <th>
                                            PostProceso
                                        </th>
                                        <th>
                                            Sedacion
                                        </th>
                                        <th>
                                            Contraste
                                        </th>
                                        <th>
                                            Encuestador
                                        </th>
                                        <th>
                                            Supervisor
                                        </th>
                                        <th>
                                            Duración
                                        </th>

                                        @*<th></th>*@
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model.tecnologo)
                                    {
                                        <tr >
                                            <td class="table_id" style="text-align: center;">
                                                @Html.DisplayFor(modelItem => item.isRevisado)
                                            </td>
                                            <td >
                                                @Html.DisplayFor(modelItem => item.tecnologo)
                                            </td>
                                            <td class="table_id">
                                                @Html.DisplayFor(modelItem => item.fecha)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.examen)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.paciente)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.modalidad)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.estudio)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.equipo)
                                            </td>
                                            <td style="text-align: center;">
                                                @Html.DisplayFor(modelItem => item.placas)
                                            </td>
                                            <td style="text-align: center;">
                                                @Html.DisplayFor(modelItem => item.imagenes)
                                            </td>
                                            <td style="text-align: center;">
                                                @Html.DisplayFor(modelItem => item.postproceso)
                                            </td>
                                            <td style="text-align: center;">
                                                @Html.DisplayFor(modelItem => item.sedacion)
                                            </td>
                                            <td style="text-align: center;">
                                                @Html.DisplayFor(modelItem => item.contraste)
                                                @if (item.continuo)
                                                {
                                                    @Html.DisplayFor(modelItem => item.continuo)
                                                }
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.encuestador)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.supervisor)
                                            </td>
                                            <td>
                                                @{ TimeSpan ts = item.tec_fin - item.tec_ini;
                                                <text>
                                                    @ts.Minutes
                                                    .min
                                                </text>
                                                }
                                            </td>
                                            @* <td class="table_id">

                                    </td>*@
                                        </tr>
                                    }

                                </tbody>
                            </table>

                        </div>
                    </div>
                </div>

             
            </div>
        </div>
    </div>

</div>