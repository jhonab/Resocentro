@model Encuesta.ViewModels.Reporte.DataReporteFrasco
@{
    ViewBag.Title = "<i class='fa fa-area-chart fa-lg'></i> Reporte Frascos";
    ViewBag.Titlenot = "Reporte Frascos";
}

@*<link href="http://netdna.bootstrapcdn.com/font-awesome/3.1.1/css/font-awesome.min.css" rel="stylesheet">
    <link href="http://cdnjs.cloudflare.com/ajax/libs/x-editable/1.4.4/bootstrap-editable/css/bootstrap-editable.css" rel="stylesheet">
    <link href="https://www.datatables.net/release-datatables/media/css/jquery.dataTables.css" rel="stylesheet">
    <link href="https://www.datatables.net/release-datatables/extensions/TableTools/css/dataTables.tableTools.css" rel="stylesheet">
    <link href="lib/bootstrap-filterable.css" rel="stylesheet" type="text/css">
    <script src="~/js/plugins/jquery.js"></script>
    <script src="~/js/plugins/dataTables/jquery.dataTables.js"></script>
    <script src="~/js/plugins/dataTables/dataTables.bootstrap.js"></script>
    <script src="~/js/plugins/dataTables/dataTables.tableTools.js"></script>*@

<script src="~/js/plugins/dataTables/buttons.print.min.js"></script>
<script src="~/js/plugins/dataTables/jquery-1.12.0.min.js"></script>
<script src="~/js/plugins/dataTables/dataTables.buttons.min.js"></script>
<script src="~/js/plugins/dataTables/jquery.dataTables.min.js"></script>
<link href="https://cdn.datatables.net/1.10.11/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="https://cdn.datatables.net/buttons/1.1.2/css/buttons.dataTables.min.css" rel="stylesheet">
<script src="https://cdn.datatables.net/tabletools/2.2.4/js/dataTables.tableTools.min.js">
</script>
<link rel="stylesheet" type="text/css"
      href="https://cdn.datatables.net/tabletools/2.2.4/css/dataTables.tableTools.css" />




@*<link rel="stylesheet" type="text/css" media="print" href="mystyle.css">*@
@*<link rel="stylesheet" href="print-style.css" type="text/css" media="print" />*@

@*<style type="text/css">
    @@import url(print-style.css) print;
    </style>*@

<script type="text/javascript">

    $(document).ready(function () {
        //$('#table_mensual').dataTable();

        load_sedes();
        load_productos();
        //$('#table_frascos').dataTable();

        //$('#table_resumen').dataTable();
        function exportTableToCSV1($table, filename, cabecera) {

            var $rows = $table.find('tr:has(td)'),
                // Temporary delimiter characters unlikely to be typed by keyboard
                // This is to avoid accidentally splitting the actual contents
                tmpColDelim = String.fromCharCode(11), // vertical tab character
                tmpRowDelim = String.fromCharCode(0), // null character

                // actual delimiter characters for CSV format
                colDelim = '","',
                rowDelim = '"\r\n"',

                // Grab text from table into CSV formatted string
                csv = cabecera + $rows.map(function (i, row) {
                    var $row = $(row),
                        $cols = $row.find('td');

                    return $cols.map(function (j, col) {
                        var $col = $(col),
                            text = $col.text();

                        return text.replace(/"/g, '""'); // escape double quotes

                    }).get().join(tmpColDelim);

                }).get().join(tmpRowDelim)
                    .split(tmpRowDelim).join(rowDelim)
                    .split(tmpColDelim).join(colDelim) + '"',

                // Data URI

                 csvData = 'data:application/csv;charset=utf-8,' + encodeURIComponent(csv);

            $(this)
                    .attr({
                        'download': filename,
                        'href': csvData,
                        'target': '_blank'
                    });

        }
        $("#btnExportDetalle").on('click', function (event) {
            // CSV
            exportTableToCSV1.apply(this, [$('#table_frascos'), 'Reporte_Frascos.csv', '"\"NOMBRE\,"\"FRASCO\,"\"CANT. INICIAL\,"\"USADO\,"\"CANT. FINAL' + '\r\n"']);

        });

        function load_sedes() {
            $.get(
                  '@Url.Action("getsedes", "Reporte")'
               )
              .done(function (data) {
                  $.each(data, function (i, row) {
                      var $option = $('<option>');
                      $option.val(row.codigosucursal);
                      $option.html(row.descripcion);
                      $('#lstsedes').append($option);
                  })
              })
              .fail(function (data) {
                  console.log('error !!!');
              }
          );
        }

        function load_productos() {
            $.get(
                '@Url.Action("getproductos", "Reporte")'
             )
            .done(function (data) {
                $.each(data, function (i, row) {
                    var $option = $('<option>');
                    $option.val(row.Al_InsumId);
                    $option.html(row.Nombre);
                    $('#lstproducto').append($option);
                })
            })
            .fail(function (data) {
                console.log('error !!!');
            }
        );
        }
    });

    $(document).ready(function () {

        $('#table_frascos').DataTable({
            "autoWidth": true,
            "sDom": 'T<"clear">lfrtip',
            "oTableTools": {
                "sSwfPath": "https://datatables.net/release-datatables/extras/TableTools/media/swf/copy_csv_xls_pdf.swf",
                "aButtons": [
                    {
                        "sExtends": "print",
                        "bShowAll": true,
                        "sInfo": "<br><center><h1>PRESIONAR CTRL + P - PARA IMPRIMIR</h1></center><br><br><center><h3>PRESIONAR ESCAPE AL TERMINAR</h3></center>",
                        "sButtonText": "Imprimir",
                        "sToolTip": "Click para Imprimir",
                        "sMessage": "<center><h1><b>REPORTE CONTRASTE - FRASCOS</h1></center>",

                        //                            "mColumns": [{ "width": "10%" }, null,
                        //null,
                        //null,
                        //null]
                    }
                ]

            }
        });
    });

</script>

    <div class="row">
        <div class="col-lg-6">
            <div class="panel panel-default">
                <div class="panel-heading">
                    Filtros
                </div>
                <div class="panel-body">


    @using (Html.BeginForm("ReporteFrasco", "Reporte", FormMethod.Get))
    {
        <script type="text/javascript">

            function validar() {
                var msj = "";
               
                if ($("#lstsedes").val() == "")
                    msj += "- Seleccione Sede \n";
                if ($("#lstproducto").val() == "")
                    msj += "- Seleccione Contraste \n";
                if (msj == "")
                    return true;
                else {
                    alert(msj);
                    return false;
                }
            }
        </script>

    <div class="form-group col-lg-6">
        <label>Sedes</label>
        <select id="lstsedes" name="lstsedes" class="form-control">
            <option value="">--- Seleccione ---</option>
        </select>
    </div>

    <div class="form-group col-lg-6">
        <label>Contrastes</label>
        <select id="lstproducto" name="lstproducto" class="form-control">
            <option value="">--- Seleccione ---</option>
        </select>
    </div>

            <input type="submit" value="Buscar" onclick="return validar();" class="btn btn-outline btn-success" />
    }
            </div>

        </div>
            </div>

</div>

<div class="row">
    <div class="col-sm-12">
        <div class="panel panel-primary">
            <div class="panel-heading">
                Reporte Frascos
                <a href="#" id="btnExportDetalle" class="btn btn-primary pull-right">Exportar a Excel</a>
            </div>
                @*<div class="panel-group" id="accordion">
                    @foreach (var item in Model.frasco.Select(x => new { x.insumoid,x.nombre }).Distinct().ToList())
                    {*@


                @*<div class="panel panel-info">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <a data-toggle="collapse" data-parent="#accordion" href="#collapse_@item.insumoid">Contraste @item.nombre</a>
                        </h4>
                    </div>
                    <div id="collapse_@item.insumoid" class="panel-collapse collapse">*@

                @*<div class="panel-body">
                    <div class="panel panel-primary">*@

                        <div class="panel-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <table id="table_frascos" class="table table-striped table-bordered table-hover ">
                                        <thead>
                                            <tr>
                                                <th width="15px">
                                                    NOMBRE
                                                </th>

                                                <th width="15px">
                                                    FRASCO
                                                </th>
                                                <th width="15px">
                                                    CANT. INICIAL
                                                </th>
                                                <th width="15px">
                                                    USADO
                                                </th>
                                                <th width="15px">
                                                    CANT. FINAL
                                                </th>
                                            </tr>
                                        </thead>
                                        @*.Where(x => x.insumoid == item.insumoid).ToList())*@
                                        <tbody>
                                            @foreach (var item1 in Model.frasco)
                                            {
                                                <tr>
                                                    <td style="text-align:right">@item1.nombre</td>
                                                    <td style="text-align:right">@item1.frasco</td>
                                                    <td style="text-align:right">@item1.inicial ml </td>
                                                    <td style="text-align:right">@item1.usado ml </td>
                                                    <td style="text-align:right">@item1.final ml </td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                    </div>

                </div>
                @*</div>
                    </div>*@
                @*}
                    </div>*@
            </div>
        </div>
