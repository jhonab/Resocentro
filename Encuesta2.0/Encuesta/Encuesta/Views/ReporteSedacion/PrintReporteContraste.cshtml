@model Encuesta.ViewModels.Reporte.DataReporteContraste
@{
    ViewBag.Title = "<i class='fa fa-area-chart fa-lg'></i> Imprimir - Reporte Contraste";
    ViewBag.Titlenot = "Imprimir - Reporte Contraste";
}


@*<link href="http://netdna.bootstrapcdn.com/font-awesome/3.1.1/css/font-awesome.min.css" rel="stylesheet">
<link href="http://cdnjs.cloudflare.com/ajax/libs/x-editable/1.4.4/bootstrap-editable/css/bootstrap-editable.css" rel="stylesheet">
<link href="https://www.datatables.net/release-datatables/media/css/jquery.dataTables.css" rel="stylesheet">
<link href="https://www.datatables.net/release-datatables/extensions/TableTools/css/dataTables.tableTools.css" rel="stylesheet">
<link href="lib/bootstrap-filterable.css" rel="stylesheet" type="text/css">
<script src="~/js/plugins/jquery.js"></script>
<script src="~/js/plugins/dataTables/jquery.dataTables.js"></script>
<script src="~/js/plugins/dataTables/dataTables.bootstrap.js"></script>
<script src="~/js/plugins/dataTables/dataTables.tableTools.js"></script>*@

<script src="~/js/plugins/dataTables/buttons.print.min.js"></script>
<script src="~/js/plugins/dataTables/jquery-1.12.0.min.js"></script>
<script src="~/js/plugins/dataTables/dataTables.buttons.min.js"></script>
<script src="~/js/plugins/dataTables/jquery.dataTables.min.js"></script>
<link href="https://cdn.datatables.net/1.10.11/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="https://cdn.datatables.net/buttons/1.1.2/css/buttons.dataTables.min.css" rel="stylesheet">
<script src="https://cdn.datatables.net/tabletools/2.2.4/js/dataTables.tableTools.min.js">
</script>
<link rel="stylesheet" type="text/css"
      href="https://cdn.datatables.net/tabletools/2.2.4/css/dataTables.tableTools.css" />
@*<link rel="stylesheet" type="text/css" media="print" href="mystyle.css">*@
@*<link rel="stylesheet" href="print-style.css" type="text/css" media="print" />*@

@*<style type="text/css">
@@import url(print-style.css) print;
</style>*@

<script type="text/javascript">
    
    $(function () {
        //$('#table_reporte').dataTable();

        //$('#table_resumen').dataTable();
        function exportTableToCSV1($table, filename,cabecera) {

            var $rows = $table.find('tr:has(td)'),
                // Temporary delimiter characters unlikely to be typed by keyboard
                // This is to avoid accidentally splitting the actual contents
                tmpColDelim = String.fromCharCode(11), // vertical tab character
                tmpRowDelim = String.fromCharCode(0), // null character

                // actual delimiter characters for CSV format
                colDelim = '","',
                rowDelim = '"\r\n"',         

                // Grab text from table into CSV formatted string
                csv = cabecera + $rows.map(function (i, row) {
                    var $row = $(row),
                        $cols = $row.find('td');

                    return $cols.map(function (j, col) {
                        var $col = $(col),
                            text = $col.text();

                        return text.replace(/"/g, '""'); // escape double quotes

                    }).get().join(tmpColDelim);

                }).get().join(tmpRowDelim)
                    .split(tmpRowDelim).join(rowDelim)
                    .split(tmpColDelim).join(colDelim) + '"',

                // Data URI

                 csvData = 'data:application/csv;charset=utf-8,' + encodeURIComponent(csv);

            $(this)
                    .attr({
                        'download': filename,
                        'href': csvData,
                        'target': '_blank'
                    });

        }
        $("#btnExportDetalle").on('click', function (event) {
            // CSV
            exportTableToCSV1.apply(this, [$('#table_reporte'), 'detalle.csv', '"\"Fecha\,"\"Sede\,"\"Nro Examen\,"\"Paciente\,"\"Edad\,"\"Peso\,"\"Estudio\,"\"Estado\,"\"Equipo\,"\"Tecnologo\,"\"Enfermera\,"\"Tipo Aplicacion\,"\"Producto\,"\"Cantidad\,"\"Nro Frasco\,"\"Aplicado' + '\r\n"']);

        });

        $("#btnExportResumen").on('click', function (event) {
            exportTableToCSV1.apply(this, [$('#table_resumen'), 'resumen.csv', '"\"Insumo\,"\"Frascos Salida\,"\"U. Medida Salida\,"\"Frascos Usados\,"\"U. Medida Usados\,"\"Frascos Saldo\,"\"U. Medida Saldo' + '\r\n"']);
            // IF CSV, don't do event.preventDefault() or return false
            // We actually need this to be a typical hyperlink
        });

        load_sedes();
        load_productos();

        function load_sedes() {
            $.get(
                  '@Url.Action("getsedes", "Reporte")'
               )
              .done(function (data) {
                  $.each(data, function (i, row) {
                      var $option = $('<option>');
                      $option.val(row.codigosucursal);
                      $option.html(row.descripcion);
                      $('#lstsede').append($option);
                  })
              })
              .fail(function (data) {
                  console.log('error !!!');
              }
          );
        }

        function load_productos() {
            $.get(
                '@Url.Action("getproductos", "Reporte")'
             )
            .done(function (data) {
                $.each(data, function (i, row) {
                    var $option = $('<option>');
                    $option.val(row.Al_InsumId);
                    $option.html(row.Nombre);
                    $('#lstproducto').append($option);
                })
            })
            .fail(function (data) {
                console.log('error !!!');
            }
        );
        }

        //$(document).ready(function () {
        //    $("#table_reporte").dataTable({
        //        "sDom": 'T<"top"i>rt<"bottom"lp><"clear">',
        //        "oTableTools": {
        //            "sSwfPath": "https://datatables.net/release-datatables/extras/TableTools/media/swf/copy_csv_xls_pdf.swf",
        //            "aButtons": ["print", "copy", "csv", "xls", "pdf", "print"]
                 
        //        }
        //    });
        //});


        //$(document).ready(function () {
        //    var table = $('#table_reporte').dataTable();
        //    var tableTools = new $.fn.dataTable.TableTools(table, {
        //        "sDom": 'T<"top"i>rt<"bottom"lp><"clear">',
        //        "oTableTools": {
        //            "sSwfPath": "https://datatables.net/release-datatables/extras/TableTools/media/swf/copy_csv_xls_pdf.swf",
        //            "aButtons": [
        //                "copy",
        //                "csv",
        //                "xls",
        //                {
        //                    "sExtends": "pdf",
        //                    "sPdfOrientation": "landscape",
        //                    "sPdfSize": "tabloid"
        //                }
                       
        //                ]
        //        }
        //    });
        //});

        //$(document).ready(function () {
        //    $('#table_reporte').dataTable({
        //        "dom": 'T<"clear">lfrtip',
        //        "tableTools": {
        //            "sSwfPath": "https://datatables.net/release-datatables/extras/TableTools/media/swf/copy_csv_xls_pdf.swf"
        //        }
        //    });
        //});

        //$(document).ready(function () {
        //    $("#table_reporte").dataTable({
        //        "sDom": 'T<"clear">lfrtip',
        //        "oTableTools": {
        //            "sSwfPath": "https://datatables.net/release-datatables/extras/TableTools/media/swf/copy_csv_xls_pdf.swf",
        //            "aButtons": [

        //                //"sExtends": "print",
        //                //"bShowAll": true,
        //                //"sInfo": "Presionar: Ctrl + P e imprimir la información generada.",
        //                //"sButtonText": "Imprimir",
        //                //"sToolTip": "Click para Imprimir"

        //            //    "sExtends": "print",
        //            //    customize: function (win) {
        //            //        $(win.document.body)
        //            //            .css('font-size', '10pt')
        //            //           .prepend(
        //            //            '<img src="http://datatables.net/media/images/logo-fade.png" style="position:absolute; top:0; left:0;" />'
        //            //        );


        //            //        $(win.document.body).find('table')
        //            //            .addClass('compact')
        //            //             .css('font-size', '10pt');
        //            //    }

        //                //}]
        //                  {
        //                      'sExtends': 'print',
        //                      'bShowAll': true,
        //                  },
        //            {
        //                'sExtends': 'pdf',
        //                'bFooter': false
        //            },
        //            {
        //                'sExtends': 'xls',
        //                'sFileName': 'Data.xls',
        //                'sButtonText': 'Save to Excel',
        //                'sBorder':true
        //            },
        //            ],
        //            'sSwfPath': '//cdn.datatables.net/tabletools/2.2.4/swf/copy_csv_xls_pdf.swf'
        //        }
        //        });
        //    $(tableTools.fnContainer()).insertBefore('#table_reporte_wrapper');
        //    //"aButtons": ["print", "copy", "csv", "xls", "pdf", "print"]
        //});

        $(document).ready(function () {
            $('#table_reporte').DataTable({
                "autoWidth": true,
                "sDom": 'T<"clear">lfrtip',
                "oTableTools": {
                    "sSwfPath": "https://datatables.net/release-datatables/extras/TableTools/media/swf/copy_csv_xls_pdf.swf",
                    "aButtons": [
                        {
                            "sExtends": "print",
                            "bShowAll": true,
                            "sInfo": "<br><center><h1>PRESIONAR CTRL + P - PARA IMPRIMIR</h1></center><br><br><center><h3>PRESIONAR ESCAPE AL TERMINAR</h3></center>",
                            "sButtonText": "Imprimir",
                            "sToolTip": "Click para Imprimir",
                            "sMessage": "<br><center><h1><b>REPORTE CONTRASTE - DETALLE</b></h1></center>",

                            //                            "mColumns": [{ "width": "10%" }, null,
                            //null,
                            //null,
                            //null]
                        }
                    ]
                 
                }
            });
        });

        $(document).ready(function () {
            var fec_ini = $("#i").val().toString();
            $("#table_resumen").dataTable({
                "autoWidth": true,
                "sDom": 'T<"clear">lfrtip',
                "oTableTools": {
                    "sSwfPath": "https://datatables.net/release-datatables/extras/TableTools/media/swf/copy_csv_xls_pdf.swf",
                    "aButtons": [{
                        "sExtends": "print",
                        "bShowAll": true,
                        "sInfo": "<br><center><h1>PRESIONAR CTRL + P - PARA IMPRIMIR</h1></center><br><br><center><h3>PRESIONAR ESCAPE AL TERMINAR</h3></center>",
                        "sButtonText": "Imprimir",
                        "sToolTip": "Click para Imprimir",
                        "sMessage": "<br><center><h1><b>REPORTE CONTRASTE - RESUMEN:" + fec_ini + "</b></h1></center>",
                        
                      
                    }],
                    //"autoWidth": true
                    //"aButtons": ["print", "copy", "csv", "xls", "pdf", "print"]
                }
            });
        });

    });

</script>


    <div class="row">
        <div class="col-lg-6">
            <div class="panel panel-default">
                <div class="panel-heading">
                    Filtros
                </div>
                <div class="panel-body">
                    @using (Html.BeginForm("PrintReporteContraste", "Reporte", FormMethod.Get))
                    {
                        <script type="text/javascript">

                            function validar() {
                                var msj = "";
                                if ($("#i").val() == "")
                                    msj += "- Ingrese la fecha de inicio \n";
                                if ($("#f").val() == "")
                                    msj += "- Ingrese la fecha de termino \n";

                                if (msj == "")
                                    return true;
                                else {
                                    alert(msj);
                                    return false;
                                }
                            }

                        </script>
                        
                        <div class="form-group col-lg-6">
                            <label>Inicio:</label>
                            <input type="date" id="i" name="i" class="form-control" />
                        </div>
                        
                        <div class="form-group col-lg-6">
                            <label>Termino:</label>
                            <input type="date" id="f" name="f" class="form-control" />
                        </div>

                        <div class="form-group col-lg-6">
                            <label>Sede</label>
                            <select id="lstsede" name="lstsede" class="form-control">
                                <option value="%">--- Seleccione Sede ---</option>
                            </select>
                        </div>

                        <div class="form-group col-lg-6">
                            <label>Producto</label>
                            <select id="lstproducto" name="lstproducto" class="form-control">
                                <option value="%">--- Seleccione Producto ---</option>
                            </select>
                        </div>

                        <input type="submit" value="Buscar" onclick="return validar();" class="btn btn-outline btn success" />
                    }
                </div>

            </div>
        </div>

    </div>

    <div class="row">
        <div class="col-sm-12">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    Reporte Contraste
                    <a href="#" id="btnExportDetalle" class="btn btn-primary pull-right">Export Detalle</a>
                </div>

                <div class="panel-body">
                    <div class="row">
                        <div class="col-md-11">
                            <table id="table_reporte" class="table table-striped table-bordered table-hover " width="107">
                                <thead>
                                    <tr>
                                        <th width="8" height="5">
                                            Fecha
                                        </th>
                                        <th width="8" height="5">
                                            Sede
                                        </th>
                                        <th width="8" height="5">
                                            Examen
                                        </th>
                                        @*<th width="10">
                                            Paciente
                                        </th>*@
                                        @*<th>
                        Edad
                    </th>
                    <th>
                        Peso
                    </th>*@
                                        <th width="25" height="5">
                                            Estudio
                                        </th>
                                        @*<th>
                        Estado   
                    </th>
                    <th>
                        Equipo
                    </th>*@
                                        <th width="3" height="5">
                                            TM
                                        </th>
                                        <th width="3" height="5">
                                            LIC
                                        </th>
                                        <th width="10" height="5">
                                            Aplicado
                                        </th>
                                        <th width="34" height="5">
                                            Producto
                                        </th>
                                        <th width="3" height="5">
                                            Cantidad
                                        </th>
                                        <th width="3" height="5">
                                            Frasco
                                        </th>
                                        @*<th>
                        Aplicado
                    </th>*@
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model.detalle)
                                    {
                                        <tr>
                                            <td width="8" height="5">@item.fechaB</td>
                                            <td width="8" height="5">@item.sede </td>
                                            <td width="8" height="5">@item.codigo </td>
                                            @*<td width="10" height="10">@item.paciente </td>*@
                                            @*<td width="auto">@item.edad  </td>
                        <td width="auto">@item.peso   </td>*@
                                            <td width="20" height="5">@item.nombreestudio </td>
                                            @*<td width="auto">@item.estadoestudio </td>*@
                                            @*<td width="auto">@item.equipo  </td>*@
                                            <td width="3" height="5">@item.tecnologo  </td>
                                            <td width="3" height="5">@item.enfermera  </td>
                                            <td width="10" height="5">@item.tipo_aplicacion  </td>
                                            <td width="20" height="5">@item.producto  </td>
<td style="text-align:right" width="3" height="5">@item.cantidad ml </td>
    <td style="text-align:right" width="3" height="5">@item.lote  </td>
                                            @*<td style="text-align:right" width="auto">@item.aplicado  </td>*@
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-sm-12">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    Resumen - Reporte Contraste
                    <a href="#" id="btnExportResumen" class="btn btn-primary pull-right">Export Resumen</a>
                </div>
                <div class="panel-body">
                    <div class="row">
                        <div class="col-md-11">
                            <table id="table_resumen" class="table table-striped table-bordered table-hover ">
                                <thead>
                                    <tr>
                                        <th>
                                            Insumo
                                        </th>
                                        <th>
                                            Frascos Salida
                                        </th>
                                        <th>
                                            U. Medida Salida
                                        </th>
                                        <th>
                                            Frascos Usados
                                        </th>
                                        <th>
                                            U. Medida Usados
                                        </th>
                                        <th>
                                            Frascos Saldo
                                        </th>
                                        <th>
                                            U. Medida Saldo
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model.resumen)
                                    {
                                        <tr>
                                            <td>@item.insumo</td>
                                            <td>@item.frascoSalida </td>
                                            <td>@item.umedidaSalida </td>
                                            <td>@item.frascoUsado </td>
                                            <td>@item.umedidaUsado  </td>
                                            <td>@item.frascoSaldo   </td>
                                            <td>@item.umedidaSaldo </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
