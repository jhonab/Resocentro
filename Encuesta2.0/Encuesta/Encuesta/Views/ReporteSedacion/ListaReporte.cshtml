@model Encuesta.ViewModels.Reporte.ReporteViewModel

@{
    ViewBag.Title = "<i class='fa fa-line-chart'></i> Reporte";
    ViewBag.Titlenot = "Reporte";
}

<!-- DataTables JavaScript -->
<script src="~/js/plugins/dataTables/jquery.dataTables.js"></script>
<script src="~/js/plugins/dataTables/dataTables.bootstrap.js"></script>
<script src="~/js/plugins/KendoChart/kendo.all.min.js"></script>
<link href="~/css/plugins/Kendochart/kendo.dataviz.min.css" rel="stylesheet" />

<div class="row">
    <div class="col-lg-12">
        <div class="box box-primary">
            <div class="box-header">

                <h2 class="box-title">Usuario:  @Membership.GetUser().UserName</h2>
            </div>
            <div class="box-body chart-responsive">


                <div class="row">
                    <div class="col-lg-6">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                Filtro de Fecha
                            </div>
                            <div class="panel-body">
                                @using (Html.BeginForm("ListaReporte", "Reporte", FormMethod.Get))
                                {
                                    <script type="text/javascript">
                                        function validar() {
                                            var msj = "";
                                            if ($("#i").val() == "")
                                                msj += "- Ingrese la fecha de inicio \n";
                                            if ($("#f").val() == "")
                                                msj += "- Ingrese la fecha de termino \n";

                                            if (msj == "")
                                                return true;
                                            else {
                                                alert(msj);
                                                return false;
                                            }
                                        }
                                    </script>
                                    <div class="form-group col-lg-6">
                                        <label>Inicio:</label>
                                        <input type="date" id="i" name="i" class="form-control" />
                                    </div>
                                    <div class="form-group col-lg-6">
                                        <label>Termino:</label>
                                        <input type="date" id="f" name="f" class="form-control" />
                                    </div>

                                    <input type="submit" value="Buscar" onclick="return validar();" class="btn btn-outline btn-success" />

                                }
                            </div>

                        </div>
                    </div>
                </div>

                <div class="panel panel-primary">
                    <div class="panel-heading">
                        <i class="fa fa-line-chart fa-fw"></i>&nbsp;Reporte Sistemas del : @Model.rangoFiltro
                    </div>
                    <!-- .panel-heading -->
                    <div class="panel-body">
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="panel panel-info">
                                    <div class="panel-heading">
                                        <i class="fa fa-bar-chart-o fa-fw"></i>Gráficos
                                    </div>
                                    <!-- /.panel-heading -->
                                    <div class="panel-body">
                                        <div class="row">
                                            @if (Model.encuestador != null && Model.encuestador.Count > 0)
                                            {
                                                <script type="text/javascript">
                                                    $(document).ready(function () {
                                                        $("#chart-encuestador").kendoChart({
                                                            theme: "Metro",
                                                            title: {
                                                                text: "Grafico de Encuestas"
                                                            },
                                                            legend: {
                                                                visible: true
                                                            },
                                                            dataSource: {
                                                                data: [@{foreach (var item in Model.encuestador.Select(x => x.fecha).Distinct().ToList())
                                                                             { <text>{date:'@item.ToString("dd/MMM")',value:@Model.encuestador.Where(x => x.fecha.ToString("yyyy/MM/dd") == item.ToString("yyyy/MM/dd")).Count(), },</text>}}]
                                                            },
                                                            series: [{
                                                                type: "line",
                                                                field: "value",
                                                                categoryField: "date"
                                                            }],
                                                            valueAxis: {
                                                                plotBands: [{
                                                                    from: 9.800,
                                                                    color: "#c00",
                                                                    opacity: 0.3
                                                                }]
                                                            },
                                                            categoryAxis: {
                                                                baseUnit: "days"
                                                            }, tooltip: {
                                                                visible: true,
                                                                template: " #= value #  "
                                                            }

                                                        });

                                                    });
                                                </script>
                                                <div class="col-lg-6">
                                                    <div id="chart-encuestador">
                                                    </div>
                                                </div>
                                            }
                                            @if (Model.supervisor != null && Model.supervisor.Count > 0)
                                            {
                                                <script type="text/javascript">
                                                    $(document).ready(function () {
                                                        $("#chart-supervisor").kendoChart({
                                                            theme: "Metro",
                                                            title: {
                                                                text: "Grafico de Supervisiones"
                                                            },
                                                            legend: {
                                                                visible: true
                                                            },
                                                            dataSource: {
                                                                data: [@{foreach (var item in Model.supervisor.Select(x => x.fecha).Distinct().ToList())
                                                                             { <text>{date:'@item.ToString("dd/MMM")',value:@Model.supervisor.Where(x => x.fecha.ToString("yyyy/MM/dd") == item.ToString("yyyy/MM/dd")).Count(), },</text>}}]
                                                            },
                                                            series: [{
                                                                type: "line",
                                                                field: "value",
                                                                categoryField: "date"
                                                            }],
                                                            valueAxis: {
                                                                plotBands: [{
                                                                    from: 0,
                                                                    to: 10,
                                                                    color: "#c00",
                                                                    opacity: 0.3
                                                                }]
                                                            },
                                                            categoryAxis: {
                                                                baseUnit: "days"
                                                            }, tooltip: {
                                                                visible: true,
                                                                template: " #= value #  "
                                                            }

                                                        });

                                                    });
                                                </script>
                                                <div class="col-lg-6">
                                                    <div id="chart-supervisor">
                                                    </div>
                                                </div>
                                            }
                                            @if (Model.tecnologo != null && Model.tecnologo.Count > 0)
                                            {
                                                <script type="text/javascript">
                                                    $(document).ready(function () {
                                                        $("#chart-tecnologo").kendoChart({
                                                            theme: "Metro",
                                                            title: {
                                                                text: "Grafico de Adquisiones"
                                                            },
                                                            legend: {
                                                                visible: false
                                                            },
                                                            dataSource: {
                                                                data: [@{foreach (var item in Model.tecnologo.Select(x => x.fecha.ToString("yyyy/MM/dd")).Distinct().ToList())
                                                                             { <text>{date:new Date('@item'),value:@Model.tecnologo.Where(x => x.fecha.ToString("yyyy/MM/dd") == item).Count(), },</text>}}]
                                                            },
                                                            series: [{
                                                                type: "line",
                                                                field: "value",
                                                                categoryField: "date"
                                                            }],valueAxis: {
                                                                plotBands: [{
                                                                    from:0,
                                                                    to: 10,
                                                                    color: "#c00",
                                                                    opacity: 0.3
                                                                }]
                                                            },
                                                            categoryAxis: {
                                                                baseUnit: "days"
                                                            }, tooltip: {
                                                                visible: true,
                                                                template: " #= value #  "
                                                            }

                                                        });

                                                    });
                                                </script>
                                                <div class="col-lg-6">
                                                    <div id="chart-tecnologo">
                                                    </div>
                                                </div>
                                            }
                                            @if (Model.postproceso != null && Model.postproceso.Count > 0)
                                            {
                                                <script type="text/javascript">
                                                    $(document).ready(function () {
                                                        $("#chart-postproceso").kendoChart({
                                                            theme: "Metro",
                                                            title: {
                                                                text: "Grafico de PostProceso"
                                                            },
                                                            legend: {
                                                                visible: false
                                                            },
                                                            dataSource: {
                                                                data: [@{foreach (var item in Model.postproceso.Select(x => x.fecha.ToString("yyyy/MM/dd")).Distinct().ToList())
                                                                             { <text>{date:new Date('@item'),value:@Model.postproceso.Where(x => x.fecha.ToString("yyyy/MM/dd") == item).Count(), },</text>}}]
                                                            },
                                                            series: [{
                                                                type: "line",
                                                                field: "value",
                                                                categoryField: "date"
                                                            }],valueAxis: {
                                                                plotBands: [{
                                                                    from: 9.8,
                                                                    to: 10,
                                                                    color: "#c00",
                                                                    opacity: 0.3
                                                                }]
                                                            },
                                                            categoryAxis: {
                                                                baseUnit: "days"
                                                            }, tooltip: {
                                                                visible: true,
                                                                template: " #= value #  "
                                                            }

                                                        });

                                                    });
                                                </script>
                                                <div class="col-lg-6">
                                                    <div id="chart-postproceso">
                                                    </div>
                                                </div>
                                            }
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="panel-group" id="accordion">

                                    @if (Model.encuestador != null && Model.encuestador.Count > 0)
                                    {
                                        <script type="text/javascript">
                                            $(document).ready(function () {
                                                $('.encuesta').dataTable();
                                            });
                                        </script>
                                        <div class="panel panel-info">
                                            <div class="panel-heading">
                                                <h4 class="panel-title">
                                                    <a data-toggle="collapse" data-parent="#accordion" href="#collapseEncuesta">Rol de Encuestador </a>
                                                    <i class="pull-right">Total: @Model.encuestador.Count()</i>
                                                </h4>
                                            </div>
                                            <div id="collapseEncuesta" class="panel-collapse collapse">
                                                <div class="panel-body">
                                                    @*<div class="panel panel-primary">
                                                        <div class="panel-heading">
                                                            Calificación de Encuestas
                                                        </div>
                                                        <div class="panel-body">
                                                            @{ double total_encu = Model.encuestador.Count * 1.0;
                                                             var list_encu = Model.encuestador.Where(x => x.isError == false).ToList();
                                                             double por_encu = (list_encu.Count() * 100.0) / total_encu;
                                                            }
                                                            <div class="row">
                                                                <div class=" col-sm-4">
                                                                    <table class="table compact table-striped ">
                                                                        <thead>
                                                                            <tr>
                                                                                <th>Total</th>
                                                                                <th>% Erroneo</th>
                                                                            </tr>
                                                                        </thead>
                                                                        <tbody>

                                                                            <tr>
                                                                                <td>@total_encu </td>
                                                                                <td>@por_encu.ToString("0.##") %</td>
                                                                            </tr>
                                                                        </tbody>
                                                                    </table>
                                                                </div>
                                                            </div>
                                                            <br />
                                                            @if (list_encu.Count() > 0)
                                                            {
                                                                <div class="row">
                                                                    <div class="col-md-12">
                                                                        <table class="table table-striped table-bordered table-hover encuesta">
                                                                            <thead>
                                                                                <tr>
                                                                                    <th>
                                                                                        Fecha
                                                                                    </th>
                                                                                    <th>
                                                                                        Examen
                                                                                    </th>
                                                                                    <th>
                                                                                        Paciente
                                                                                    </th>
                                                                                    <th>
                                                                                        Estudio
                                                                                    </th>
                                                                                    <th>
                                                                                        Supervisor
                                                                                    </th>
                                                                                    <th>
                                                                                        Error
                                                                                    </th>
                                                                                   
                                                                                </tr>
                                                                            </thead>
                                                                            <tbody>
                                                                                @foreach (var item in list_encu)
                                                                                {
                                                                                <tr>
                                                                                    <td class="table_id">
                                                                                        @Html.DisplayFor(modelItem => item.fecha, "ShortDateTime")
                                                                                    </td>
                                                                                    <td>
                                                                                        @Html.DisplayFor(modelItem => item.examen)
                                                                                    </td>
                                                                                    <td>
                                                                                        @Html.DisplayFor(modelItem => item.paciente)
                                                                                    </td>
                                                                                    <td>
                                                                                        @Html.DisplayFor(modelItem => item.estudio)
                                                                                    </td>
                                                                                    <td>
                                                                                        @Html.DisplayFor(modelItem => item.supervisor)
                                                                                    </td>
                                                                                    <td>
                                                                                        <code> @Html.DisplayFor(modelItem => item.error)</code>
</td>
                                                                                    
                                                                                </tr>
                                                                                }

                                                                            </tbody>
                                                                        </table>
                                                                    </div>
                                                                </div>
                                                            }
                                                        </div>
                                                    </div>*@
                                                    <div class="panel panel-primary">
                                                        <div class="panel-heading">
                                                            Encuestas Realizadas
                                                        </div>
                                                        <div class="panel-body">

                                                            <table class="table table-striped table-bordered table-hover encuesta">
                                                                <thead>
                                                                    <tr>
                                                                        <th>
                                                                            Fecha
                                                                        </th>
                                                                        <th>
                                                                            Examen
                                                                        </th>
                                                                        <th>
                                                                            Paciente
                                                                        </th>
                                                                        <th>
                                                                            Estudio
                                                                        </th>
                                                                        <th>
                                                                            Equipo
                                                                        </th>
                                                                        <th>
                                                                            Supervisor
                                                                        </th>
                                                                        <th>
                                                                            Inicio
                                                                        </th>
                                                                        <th>
                                                                            Fin
                                                                        </th>
                                                                        <th>
                                                                            Duración
                                                                        </th>
                                                                        @*<th></th>*@
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    @foreach (var item in Model.encuestador)
                                                                    {
                                                                        <tr>
                                                                            <td class="table_id">
                                                                                @Html.DisplayFor(modelItem => item.fecha, "ShortDateTime")
                                                                            </td>
                                                                            <td>
                                                                                @Html.DisplayFor(modelItem => item.examen)
                                                                            </td>
                                                                            <td>
                                                                                @Html.DisplayFor(modelItem => item.paciente)
                                                                            </td>
                                                                            <td>
                                                                                @Html.DisplayFor(modelItem => item.estudio)
                                                                            </td>
                                                                            <td>
                                                                                @Html.DisplayFor(modelItem => item.equipo)
                                                                            </td>
                                                                            <td>
                                                                                @Html.DisplayFor(modelItem => item.supervisor)
                                                                            </td>
                                                                            <td>
                                                                                @Html.DisplayFor(modelItem => item.encu_ini, "ShortTime")
                                                                            </td>
                                                                            <td>
                                                                                @Html.DisplayFor(modelItem => item.encu_fin, "ShortTime")
                                                                            </td>
                                                                            <td>
                                                                                @{ TimeSpan ts = item.encu_fin - item.encu_ini;
                                                                                <text>
                                                                                    @ts.Minutes
                                                                                    .min
                                                                                </text>
                                                                                }
                                                                            </td>
                                                                            @* <td class="table_id">

                                                                                </td>*@
                                                                        </tr>
                                                                    }

                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    }

                                    @if (Model.supervisor != null && Model.supervisor.Count > 0)
                                    {
                                        <script>
                                            $(document).ready(function () {
                                                $('.supervisor').dataTable();
                                            });
                                        </script>
                                        <div class="panel panel-info">
                                            <div class="panel-heading">
                                                <h4 class="panel-title">
                                                    <a data-toggle="collapse" data-parent="#accordion" href="#collapseSupervisor">Rol de Supervisor</a>
                                                    <i class="pull-right">Total: @Model.supervisor.Count()</i>
                                                </h4>
                                            </div>
                                            <div id="collapseSupervisor" class="panel-collapse collapse">
                                                <div class="panel-body">
                                                    @*@{ double total_sup = Model.supervisor.Count * 1.0;
                                                     var list_sup = Model.supervisor.Where(x => x.isError == false || x.isError_p2 == false || x.isError_p3 == false || x.isError_p4 == false).ToList();
                                                     double p1 = (list_sup.Where(x => x.isError == false).Count() * 100.0) / total_sup;
                                                     double p2 = (list_sup.Where(x => x.isError_p2 == false).Count() * 100.0) / total_sup;
                                                     double p3 = (list_sup.Where(x => x.isError_p3 == false).Count() * 100.0) / total_sup;
                                                     double p4 = (list_sup.Where(x => x.isError_p4 == false).Count() * 100.0) / total_sup;
                                                    }
                                                  

                                                    <div class="panel panel-primary">
                                                        <div class="panel-heading">
                                                            Auditoria de calificaciones y Dx Preliminar
                                                        </div>
                                                        <div class="panel-body">                                                           
                                                            <div class="row">
                                                                <div class=" col-sm-4">
                                                                    <table class="table compact table-striped ">
                                                                        <thead>
                                                                            <tr>
                                                                                <th>Total Supervisiones</th>
                                                                                <th>% Discrepancia en su calificaciones de Encuesta</th>
                                                                                <th>% Discrepancia en su calificaciones de Imagenes</th>
                                                                                <th>% Discrepancia en su calificaciones de Objetivo Clínico</th>
                                                                                <th>% Calificacion de su Diagnostico</th>
                                                                            </tr>
                                                                        </thead>
                                                                        <tbody>

                                                                            <tr>
                                                                                <td>@total_sup </td>
                                                                                <td>@p1.ToString("0.##") %</td>
                                                                                <td>@p2.ToString("0.##") %</td>
                                                                                <td>@p3.ToString("0.##") %</td>
                                                                                <td>@p4.ToString("0.##") %</td>
                                                                            </tr>
                                                                        </tbody>
                                                                    </table>
                                                                </div>
                                                            </div>
                                                            <br />
                                                            @if (list_sup.Count() > 0)
                                                            {
                                                                <div class="row">
                                                                    <div class="col-md-12">
                                                                        <table class="table table-striped table-bordered table-hover supervisor">
                                                                            <thead>
                                                                                <tr>
                                                                                    <th>
                                                                                        Fecha
                                                                                    </th>
                                                                                    <th>
                                                                                        Examen
                                                                                    </th>
                                                                                    <th>
                                                                                        Paciente
                                                                                    </th>
                                                                                    <th>
                                                                                        Estudio
                                                                                    </th>
                                                                                    <th>
                                                                                        Med. Calificador
                                                                                    </th>
                                                                                    <th>
                                                                                        Encuesta
                                                                                    </th>
                                                                                    <th>
                                                                                        Imagenes
                                                                                    </th>
                                                                                    <th>
                                                                                        Objetivo Clínico
                                                                                    </th>
                                                                                    <th>
                                                                                        Diagnostico
                                                                                    </th>
                                                                                    <th></th>
                                                                                </tr>
                                                                            </thead>
                                                                            <tbody>
                                                                                @foreach (var item in list_sup)
                                                                                {
                                                                                    <tr>
                                                                                        <td class="table_id">
                                                                                            @Html.DisplayFor(modelItem => item.fecha, "ShortDateTime")
                                                                                        </td>
                                                                                        <td>
                                                                                            @Html.DisplayFor(modelItem => item.examen)
                                                                                        </td>
                                                                                        <td>
                                                                                            @Html.DisplayFor(modelItem => item.paciente)
                                                                                        </td>
                                                                                        <td>
                                                                                            @Html.DisplayFor(modelItem => item.estudio)
                                                                                        </td>
                                                                                        <td>
                                                                                            @Html.DisplayFor(modelItem => item.med_Calificador)
                                                                                        </td>
                                                                                        <td>
                                                                                            <code> @Html.DisplayFor(modelItem => item.error)</code>
                                                                                        </td>
                                                                                        <td>
                                                                                            <code> @Html.DisplayFor(modelItem => item.Error_p2)</code>
                                                                                        </td>
                                                                                        <td>
                                                                                            <code>@Html.DisplayFor(modelItem => item.Error_p3)</code>
                                                                                        </td>
                                                                                        <td>
                                                                                            @if (!item.isError_p4.Value)
                                                                                            {
                                                                                                <code>
                                                                                                    Incorrecto
                                                                                                </code>
                                                                                            }
                                                                                        </td>
                                                                                    </tr>
                                                                                }

                                                                            </tbody>
                                                                        </table>
                                                                    </div>
                                                                </div>
                                                            }
                                                        </div>
                                                    </div>*@

                                                    <div class="panel panel-primary">
                                                        <div class="panel-heading">
                                                            Supervisiones
                                                        </div>
                                                        <div class="panel-body">

                                                            <table class="table table-striped table-bordered table-hover supervisor" id="tabla_supervisor">
                                                                <thead>
                                                                    <tr>
                                                                        <th>
                                                                            Fecha
                                                                        </th>
                                                                        <th>
                                                                            Examen
                                                                        </th>
                                                                        <th>
                                                                            Paciente
                                                                        </th>
                                                                        <th>
                                                                            Estudio
                                                                        </th>
                                                                        <th>
                                                                            Equipo
                                                                        </th>
                                                                        <th>
                                                                            Encuestador
                                                                        </th>
                                                                        <th>
                                                                            Sol. Super.
                                                                        </th>
                                                                        <th>
                                                                            Inicio Super.
                                                                        </th>
                                                                        <th>
                                                                            Respuesta
                                                                        </th>
                                                                        @*<th></th>*@
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    @foreach (var item in Model.supervisor)
                                                                    {
                                                                        <tr>
                                                                            <td class="table_id">
                                                                                @Html.DisplayFor(modelItem => item.fecha, "ShortDateTime")
                                                                            </td>
                                                                            <td>
                                                                                @Html.DisplayFor(modelItem => item.examen)
                                                                            </td>
                                                                            <td>
                                                                                @Html.DisplayFor(modelItem => item.paciente)
                                                                            </td>
                                                                            <td>
                                                                                @Html.DisplayFor(modelItem => item.estudio)
                                                                            </td>
                                                                            <td>
                                                                                @Html.DisplayFor(modelItem => item.equipo)
                                                                            </td>
                                                                            <td>
                                                                                @Html.DisplayFor(modelItem => item.encuestador)
                                                                            </td>
                                                                            <td>
                                                                                @Html.DisplayFor(modelItem => item.soli_ini, "ShortTime")
                                                                            </td>
                                                                            <td>
                                                                                @Html.DisplayFor(modelItem => item.ini_super, "ShortTime")
                                                                            </td>
                                                                            <td>
                                                                                @{ TimeSpan ts = item.ini_super - item.soli_ini;
                                                                                <text>
                                                                                    @ts.Minutes
                                                                                    .min
                                                                                </text>
                                                                                }
                                                                            </td>
                                                                            @* <td class="table_id">

                                                                                </td>*@
                                                                        </tr>
                                                                    }

                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    }
                                    @*@if (User.IsInRole("18") && !User.IsInRole("3"))
                                    {
                                        <script>
                                            $(document).ready(function () {
                                                $('.supervisor').dataTable();
                                            });
                                        </script>
                                        <div class="panel panel-info">
                                            <div class="panel-heading">
                                                <h4 class="panel-title">
                                                    <a data-toggle="collapse" data-parent="#accordion" href="#collapseLecto">Rol de Médico Informante</a>
                                                    <i class="pull-right">Total: @Model.informante.Count()</i>
                                                </h4>
                                            </div>
                                            <div id="collapseLecto" class="panel-collapse collapse">
                                                <div class="panel-body">
                                                    @{ double total_inf = Model.informante.Count * 1.0;
                                                     var list_sup = Model.informante.Where(x => x.isError == false || x.isError_p2 == false || x.isError_p3 == false || x.isError_p4 == false).ToList();
                                                     double p1 = (list_sup.Where(x => x.isError == false).Count() * 100.0) / total_inf;
                                                     double p2 = (list_sup.Where(x => x.isError_p2 == false).Count() * 100.0) / total_inf;
                                                     double p3 = (list_sup.Where(x => x.isError_p3 == false).Count() * 100.0) / total_inf;
                                                     double p4 = (list_sup.Where(x => x.isError_p4 == false).Count() * 100.0) / total_inf;


                                                     double total_inf_reg = Model.contador_inf.Count*1.0;
                                                     double no_realizados_inf = (Model.contador_inf.Where(x => x == 0).ToList().Count * 100.0) / total_inf_reg;

                                                     double total_val_reg = Model.contador_val.Count * 1.0;
                                                     double no_realizados_val = (Model.contador_val.Where(x => x == 0).ToList().Count * 100.0) / total_val_reg;
                                                    }


                                                    <div class="panel panel-primary">
                                                        <div class="panel-heading">
                                                            Auditoria de Calificaciones
                                                        </div>
                                                        <div class="panel-body">
                                                            <div class="row">
                                                                <div class=" col-sm-6">
                                                                    <table class="table compact table-striped ">
                                                                        <thead>
                                                                            <tr>
                                                                                <th>Total Exámenes Informados</th>
                                                                                <th>% Calificaciones no realizadas como Informante</th>
                                                                                <th>% Calificaciones no realizadas como Validador</th>
                                                                                <th>% Discrepancia en su calificación de Encuesta</th>
                                                                                <th>% Discrepancia en su calificación de Imagenes</th>
                                                                                <th>% Discrepancia en su calificación de Objetivo Clínico</th>
                                                                                <th>% Discrepancia en su calificación de Dx Preliminar</th>
                                                                            </tr>
                                                                        </thead>
                                                                        <tbody>

                                                                            <tr>
                                                                                <td style="text-align: center">@total_inf </td>
                                                                                <td style="text-align: center">@no_realizados_inf.ToString("0.##") %</td>
                                                                                <td style="text-align: center">@no_realizados_val.ToString("0.##") %</td>
                                                                                <td style="text-align: center">@p1.ToString("0.##") %</td>
                                                                                <td style="text-align: center">@p2.ToString("0.##") %</td>
                                                                                <td style="text-align: center">@p3.ToString("0.##") %</td>
                                                                                <td style="text-align: center">@p4.ToString("0.##") %</td>
                                                                            </tr>
                                                                        </tbody>
                                                                    </table>
                                                                </div>
                                                            </div>
                                                            <br />
                                                            @if (list_sup.Count() > 0)
                                                            {
                                                                <div class="row">
                                                                    <div class="col-md-12">
                                                                        <table class="table table-striped table-bordered table-hover supervisor">
                                                                            <thead>
                                                                                <tr>
                                                                                    <th>
                                                                                        Fecha
                                                                                    </th>
                                                                                    <th>
                                                                                        Examen
                                                                                    </th>
                                                                                    <th>
                                                                                        Paciente
                                                                                    </th>
                                                                                    <th>
                                                                                        Estudio
                                                                                    </th>
                                                                                    <th>
                                                                                        Med. Calificador
                                                                                    </th>
                                                                                    <th>
                                                                                        Encuesta
                                                                                    </th>
                                                                                    <th>
                                                                                        Imagenes
                                                                                    </th>
                                                                                    <th>
                                                                                        Objetivo Clínico
                                                                                    </th>
                                                                                    <th>
                                                                                        Diagnostico
                                                                                    </th>
                                                                                </tr>
                                                                            </thead>
                                                                            <tbody>
                                                                                @foreach (var item in list_sup)
                                                                                {
                                                                                    <tr>
                                                                                        <td class="table_id">
                                                                                            @Html.DisplayFor(modelItem => item.fecha, "ShortDateTime")
                                                                                        </td>
                                                                                        <td>
                                                                                            @Html.DisplayFor(modelItem => item.examen)
                                                                                        </td>
                                                                                        <td>
                                                                                            @Html.DisplayFor(modelItem => item.paciente)
                                                                                        </td>
                                                                                        <td>
                                                                                            @Html.DisplayFor(modelItem => item.estudio)
                                                                                        </td>
                                                                                        <td>
                                                                                            @Html.DisplayFor(modelItem => item.med_Calificador)
                                                                                        </td>
                                                                                        <td>
                                                                                            <code> @Html.DisplayFor(modelItem => item.error)</code>
                                                                                        </td>
                                                                                        <td>
                                                                                            <code> @Html.DisplayFor(modelItem => item.Error_p2)</code>
                                                                                        </td>
                                                                                        <td>
                                                                                            <code>@Html.DisplayFor(modelItem => item.Error_p3)</code>
                                                                                        </td>
                                                                                        <td>
                                                                                            @if (!item.isError_p4.Value)
                                                                                            {
                                                                                                <code>
                                                                                                    Incorrecto
                                                                                                </code>
                                                                                            }
                                                                                        </td>
                                                                                    </tr>
                                                                                }

                                                                            </tbody>
                                                                        </table>
                                                                    </div>
                                                                </div>
                                                            }
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    }*@

                                    @if (Model.tecnologo != null && Model.tecnologo.Count > 0)
                                    {
                                        <script>
                                            var tabla_tecnologo;
                                            var url;
                                            var pac;
                                            $(document).ready(function () {
                                                tabla_tecnologo= $('.tecnologo').DataTable();
                                                $('#tabla_adquisicion tbody').on('contextmenu', 'td', function (e) {
                                                    var rowIdx = tabla_tecnologo
                                                        .cell(this)
                                                        .index().row;
                                                    var imagen=(tabla_tecnologo.cell(rowIdx, 8).data());

                                                    if(!(imagen.indexOf("checked") >= 0)){
                                                        var items="";
                                                        var examen=(tabla_tecnologo.cell(rowIdx, 2).data());
                                                        pac=(tabla_tecnologo.cell(rowIdx, 3).data()).split(" ");
                                                        url="http://xero.resocentro.com/#PatientName="+pac[0]+"&StudyDateTime=Today"
                                                        var modalidad=(tabla_tecnologo.cell(rowIdx, 4).data());
                                                        if(modalidad!="")
                                                            url="http://xero.resocentro.com/#PatientName="+pac[0]+"&StudyDateTime=Today&ModalitiesInStudy="+modalidad;
                                                        items += '<li><a tabindex="-1" href="javascript:buscarImpax(' + examen + ');"><i class="fa fa-search fa-lg " style="color: #078EF8"></i>&nbsp;&nbsp;Buscar en Impax</a></li>'

                                                        $("#contextMenu").html(items);
                                                        $("#contextMenu").css({
                                                            display: "block",
                                                            left: e.pageX,
                                                            top: e.pageY
                                                        });
                                                    }
                                                    $(document).click(function () {
                                                        $("#contextMenu").hide();
                                                    });
                                                    return false;
                                                });
                                            });
                                            function buscarImpax(codigo ){
                                                //$("#num_examen").val(codigo);
                                                //$("#patientid").val("");
                                                //$("#pac_nombre").val(pac[0]);
                                                //$("#studies").val("");
                                                //$('#myModal').modal("show")
                                                window.open(url, '_blank');
                                            }
                                        </script>
                                        <div class="panel panel-info">
                                            <div class="panel-heading">
                                                <h4 class="panel-title" style="height:36px!important;">
                                                    <a data-toggle="collapse" data-parent="#accordion" href="#collapseTecnologo">Tecnólogo</a>
                                                    <label class="pull-right">
                                                        <i>No Impax: @Model.tecnologo.Where(x => x.imagenes == false).Count()</i>&nbsp;&nbsp;
                                                        <i>Total: @Model.tecnologo.Count()</i>&nbsp;&nbsp;
                                                        <i>Revisadas: @Model.tecnologo.Where(x => x.isRevisado == true).Count()</i>&nbsp;&nbsp;
                                                        @if (Model.isRevisado)
                                                        {
                                                            <a href="@Url.Action("CerrarTurno","Reporte")" class="btn btn-primary">Revisadas</a>
                                                        }
                                                    </label>
                                                </h4>
                                            </div>
                                            <div id="collapseTecnologo" class="panel-collapse collapse">
                                                <div class="panel-body">
                                                    @*<div class="panel panel-primary">
                                                        <div class="panel-heading">
                                                            Calificación de Aquisión de Examen
                                                        </div>
                                                        <div class="panel-body">
                                                           @{ double total_tec = Model.tecnologo.Count * 1.0;
                                                             var list_tec = Model.tecnologo.Where(x => x.isError_p2 == false || x.isError_p3 == false).ToList();

                                                             double por_p2 = (list_tec.Where(x => x.isError_p2 == false).Count() * 100.0) / total_tec;
                                                             double por_p3 = (list_tec.Where(x => x.isError_p3 == false).Count() * 100.0) / total_tec;
                                                            }
                                                            <div class="row">
                                                                <div class=" col-sm-4">
                                                                    <table class="table compact table-striped ">
                                                                        <thead>
                                                                            <tr>
                                                                                <th>Total</th>
                                                                                <th>% Imágenes</th>
                                                                                <th>% Objetivo Clínico</th>
                                                                            </tr>
                                                                        </thead>
                                                                        <tbody>

                                                                            <tr>
                                                                                <td>@total_tec </td>
                                                                                <td>@por_p2.ToString("0.##") %</td>
                                                                                <td>@por_p3.ToString("0.##") %</td>
                                                                            </tr>
                                                                        </tbody>
                                                                    </table>
                                                                </div>
                                                            </div>
                                                            <br />
                                                            @if (list_tec.Count() > 0)
                                                            {
                                                                <div class="row">
                                                                    <div class="col-md-12">
                                                                        <table class="table table-striped table-bordered table-hover">
                                                                            <thead>
                                                                                <tr>
                                                                                    <th>
                                                                                        Fecha
                                                                                    </th>
                                                                                    <th>
                                                                                        Examen
                                                                                    </th>
                                                                                    <th>
                                                                                        Paciente
                                                                                    </th>
                                                                                    <th>
                                                                                        Estudio
                                                                                    </th>
                                                                                    <th>
                                                                                        Supervisor
                                                                                    </th>
                                                                                    <th>
                                                                                        Error Imagen
                                                                                    </th>
                                                                                    <th>
                                                                                        Error Objetivo Clínico
                                                                                    </th>
                                                                                </tr>
                                                                            </thead>
                                                                            <tbody>
                                                                                @foreach (var item in list_tec)
                                                                                {
                                                                                    <tr>
                                                                                        <td class="table_id">
                                                                                            @Html.DisplayFor(modelItem => item.fecha, "ShortDateTime")
                                                                                        </td>
                                                                                        <td>
                                                                                            @Html.DisplayFor(modelItem => item.examen)
                                                                                        </td>
                                                                                        <td>
                                                                                            @Html.DisplayFor(modelItem => item.paciente)
                                                                                        </td>
                                                                                        <td>
                                                                                            @Html.DisplayFor(modelItem => item.estudio)
                                                                                        </td>
                                                                                        <td>
                                                                                            @Html.DisplayFor(modelItem => item.supervisor)
                                                                                        </td>
                                                                                        <td>
                                                                                            <code> @Html.DisplayFor(modelItem => item.Error_p2)</code>
</td>
                                                                                        <td>
                                                                                            <code> @Html.DisplayFor(modelItem => item.Error_p3)</code>
</td>
                                                                                    </tr>
                                                                                }

                                                                            </tbody>
                                                                        </table>
                                                                    </div>
                                                                </div>
                                                            }
                                                            <div class="panel panel-primary">
                                                                <div class="panel-heading">
                                                                    Calificación de Supervición
                                                                </div>
                                                                <div class="panel-body">


                                                                </div>
                                                            </div>

                                                        </div>
                                                    </div>*@
                                                    <div class="panel panel-primary">
                                                        <div class="panel-heading">
                                                            Adquisiciones
                                                        </div>
                                                        <div class="panel-body">
                                                            <table class="table table-striped table-bordered table-hover tecnologo" id="tabla_adquisicion">
                                                                <thead>
                                                                    <tr>
                                                                        <th>
                                                                            Revisado
                                                                        </th>
                                                                        <th>
                                                                            Fecha
                                                                        </th>
                                                                        <th>
                                                                            Examen
                                                                        </th>
                                                                        <th>
                                                                            Paciente
                                                                        </th>
                                                                        <th>
                                                                            Mod.
                                                                        </th>
                                                                        <th>
                                                                            Estudio
                                                                        </th>
                                                                        <th>
                                                                            Equipo
                                                                        </th>
                                                                        <th>
                                                                            Placas
                                                                        </th>
                                                                        <th>
                                                                            Imagenes
                                                                        </th>
                                                                        <th>
                                                                            PostProceso
                                                                        </th>
                                                                        <th>
                                                                            Sedacion
                                                                        </th>
                                                                        <th>
                                                                            Contraste
                                                                        </th>
                                                                        <th>
                                                                            Encuestador
                                                                        </th>
                                                                        <th>
                                                                            Supervisor
                                                                        </th>
                                                                        <th>
                                                                            Duración
                                                                        </th>

                                                                        @*<th></th>*@
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    @foreach (var item in Model.tecnologo)
                                                                    {
                                                                        <tr>
                                                                            <td class="table_id" style="text-align: center;">
                                                                                @Html.DisplayFor(modelItem => item.isRevisado)
                                                                            </td>
                                                                            <td class="table_id">
                                                                                @Html.DisplayFor(modelItem => item.fecha)
                                                                            </td>
                                                                            <td>
                                                                                @Html.DisplayFor(modelItem => item.examen)
                                                                            </td>
                                                                            <td>
                                                                                @Html.DisplayFor(modelItem => item.paciente)
                                                                            </td>
                                                                            <td>
                                                                                @Html.DisplayFor(modelItem => item.modalidad)
                                                                            </td>
                                                                            <td>
                                                                                @Html.DisplayFor(modelItem => item.estudio)
                                                                            </td>
                                                                            <td>
                                                                                @Html.DisplayFor(modelItem => item.equipo)
                                                                            </td>
                                                                            <td style="text-align: center;">
                                                                                @Html.DisplayFor(modelItem => item.placas)
                                                                            </td>
                                                                            <td style="text-align: center;">
                                                                                @Html.DisplayFor(modelItem => item.imagenes)
                                                                            </td>
                                                                            <td style="text-align: center;">
                                                                                @Html.DisplayFor(modelItem => item.postproceso)
                                                                            </td>
                                                                            <td style="text-align: center;">
                                                                                @Html.DisplayFor(modelItem => item.sedacion)
                                                                            </td>
                                                                            <td style="text-align: center;">
                                                                                @Html.DisplayFor(modelItem => item.contraste)
                                                                                @if (item.continuo)
                                                                                {
                                                                                    @Html.DisplayFor(modelItem => item.continuo)
                                                                                }
                                                                            </td>
                                                                            <td>
                                                                                @Html.DisplayFor(modelItem => item.encuestador)
                                                                            </td>
                                                                            <td>
                                                                                @Html.DisplayFor(modelItem => item.supervisor)
                                                                            </td>
                                                                            <td>
                                                                                @{ TimeSpan ts = item.tec_fin - item.tec_ini;
                                                                                <text>
                                                                                    @ts.Minutes
                                                                                    .min
                                                                                </text>
                                                                                }
                                                                            </td>
                                                                            @* <td class="table_id">

                                                                                </td>*@
                                                                        </tr>
                                                                    }

                                                                </tbody>
                                                            </table>

                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    }
                                    @if (Model.postproceso != null && Model.postproceso.Count > 0)
                                    {
                                        <script>
                                            $(document).ready(function () {
                                                $('#tabla_postproceso').dataTable();
                                            });
                                        </script>
                                        <div class="panel panel-info">
                                            <div class="panel-heading">
                                                <h4 class="panel-title">
                                                    <a data-toggle="collapse" data-parent="#accordion" href="#collapsePostProceso">PostProceso</a>
                                                    <i class="pull-right">Total: @Model.postproceso.Sum(x=> x.valorPro)</i>
                                                </h4>
                                            </div>
                                            <div id="collapsePostProceso" class="panel-collapse collapse">
                                                <div class="panel-body">

                                                    <div class="panel panel-primary">
                                                        <div class="panel-heading">
                                                            PostProceso
                                                        </div>
                                                        <div class="panel-body">
                                                            <table class="table table-striped table-bordered table-hover" id="tabla_postproceso">
                                                                <thead>
                                                                    <tr>
                                                                        <th>
                                                                            Fecha
                                                                        </th>
                                                                        <th>
                                                                            Examen
                                                                        </th>
                                                                        <th>
                                                                            Paciente
                                                                        </th>
                                                                        <th>
                                                                            Estudio
                                                                        </th>
                                                                        <th>
                                                                            Técnicas
                                                                        </th>
                                                                        <th>
                                                                            Valor
                                                                        </th>

                                                                        @*<th></th>*@
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    @foreach (var item in Model.postproceso)
                                                                    {
                                                                        <tr>
                                                                            <td class="table_id">
                                                                                @Html.DisplayFor(modelItem => item.fecha, "ShortDateTime")
                                                                            </td>
                                                                            <td>
                                                                                @Html.DisplayFor(modelItem => item.examen)
                                                                            </td>
                                                                            <td>
                                                                                @Html.DisplayFor(modelItem => item.paciente)
                                                                            </td>
                                                                            <td>
                                                                                @Html.DisplayFor(modelItem => item.estudio)
                                                                            </td>
                                                                            <td>
                                                                                @Html.DisplayFor(modelItem => item.tecnica)
                                                                            </td>
                                                                            <td>
                                                                                @Html.DisplayFor(modelItem => item.valorPro)
                                                                            </td>

                                                                            @* <td class="table_id">

                                                                                </td>*@
                                                                        </tr>
                                                                    }

                                                                </tbody>
                                                            </table>

                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    }
                                    @if (Model.enfermera != null && Model.enfermera.Count > 0)
                                    {
                                        <script>
                                            $(document).ready(function () {
                                                $('#tabla_enfermera').dataTable();
                                            });
                                        </script>
                                        <div class="panel panel-info">
                                            <div class="panel-heading">
                                                <h4 class="panel-title">
                                                    <a data-toggle="collapse" data-parent="#accordion" href="#collapseenfermera">Enfermera</a>
                                                    <i class="pull-right">Total: @Model.enfermera.Count()</i>
                                                </h4>
                                            </div>
                                            <div id="collapseenfermera" class="panel-collapse collapse">
                                                <div class="panel-body">

                                                    <div class="panel panel-primary">
                                                        <div class="panel-heading">
                                                            Enfermera
                                                        </div>
                                                        <div class="panel-body">
                                                            <table class="table table-striped table-bordered table-hover" id="tabla_enfermera">
                                                                <thead>
                                                                    <tr>
                                                                        <th>
                                                                            Fecha
                                                                        </th>
                                                                        <th>
                                                                            Examen
                                                                        </th>
                                                                        <th>
                                                                            Paciente
                                                                        </th>
                                                                        <th>
                                                                            Estudio
                                                                        </th>
                                                                        <th>
                                                                            Insumos
                                                                        </th>
                                                                       

                                                                        @*<th></th>*@
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    @foreach (var item in Model.enfermera)
                                                                    {
                                                                        <tr>
                                                                            <td class="table_id">
                                                                                @Html.DisplayFor(modelItem => item.fecha, "ShortDateTime")
                                                                            </td>
                                                                            <td>
                                                                                @Html.DisplayFor(modelItem => item.examen)
                                                                            </td>
                                                                            <td>
                                                                                @Html.DisplayFor(modelItem => item.paciente)
                                                                            </td>
                                                                            <td>
                                                                                @Html.DisplayFor(modelItem => item.estudio)
                                                                            </td>
                                                                            <td>
                                                                                @Html.DisplayFor(modelItem => item.insumos)
                                                                            </td>    
                                                                            @* <td class="table_id">

                        </td>*@
                                                                        </tr>
                                                                    }

                                                                </tbody>
                                                            </table>

                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    }
                                </div>

                            </div>
                        </div>
                    </div>
                    <!-- .panel-body -->
                </div>
            </div>
        </div>
    </div>

</div>
<ul id="contextMenu" class="dropdown-menu" role="menu" style="display:none"></ul>


<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">Actualizar Link de Imagenes</h4>
            </div>
            <div class="modal-body">
                <script type="text/javascript">
                    $(function(){
                        $("#patientid").change(generarLink);
                        $("#studies").change(generarLink);
                    });
                    function generarLink(){
                        var texto= $("#patientid").val();
                        var studi= $("#studies").val();
                        var _paci= $("#pac_nombre").val();
                        if(texto!=""&& studi!=""){
                            var _url='http://xero.resocentro.com/#tab=Display&PatientName='+_paci+'&PatientID='+texto+'&studies='+studi;

                            $("#link").html('<a target="_blank" href="'+_url+'">Link Impax</a>');
                        }
                        else
                            $("#link").html("");
                    }
                </script>
                <input type="hidden" id="num_examen" />
                <input type="hidden" id="pac_nombre" />
                <div class="form-group">
                    <label>PatientID:</label>
                    <input type="text" id="patientid" class="form-control" />
                </div>
                <div class="form-group">
                    <label>Studies:</label>
                    <input type="text" id="studies" class="form-control" />
                </div>
                <div class="form-group">
                    <label id="link"></label>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
                <button type="button" class="btn btn-primary">Actualizar</button>
            </div>
        </div>
    </div>
</div>