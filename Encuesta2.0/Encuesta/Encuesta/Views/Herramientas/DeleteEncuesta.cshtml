@{
    ViewBag.Title = "<i class='fa fa-gear '></i> Herramientas";
    ViewBag.Titlenot = "Herramientas";
}
<script src="~/js/jquery-ui.min.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
        $("#msj").hide()//ocultar el msj
        ocultarListas();
    });
    function ocultarListas() {
        $("#div_partial_encuesta").hide();
    }
    function mostrarListas() {
        var btn = ($("#btncargarEncuesta").html());
        if (btn.indexOf('Buscar') !== -1) {

            $("#num_exam").prop("disabled", true)
            $("#btncargarEncuesta").html("<i class='fa fa-search'></i>&nbsp;&nbsp;Nueva Busqueda");
            $("#div_partial_encuesta").show();
        }
        else {
            $("#num_exam").prop("disabled", false)
            $("#btncargarEncuesta").html("<i class='fa fa-search'></i>&nbsp;&nbsp;Buscar");
            $("#num_exam").val("");
            $("#partial_encuesta").html("");
            ocultarListas();
        }

    }
    function cargarEncuesta() {
        var examen = $("#num_exam").val();
        if (examen != "" && examen > 0) {

            $.ajax({
                url: "@Url.Action("GetEncuesta", "Herramientas")",
                data: { examen: examen ,paciente:""},
                dataType: "json",
                type: "POST",
                error: function () {
                    mostrarmensaje(4, 'Ocurrio un problema y <b>NO</b> se enviaron los datos al sistema');
                },
                success: function (data) {
                    if (data.result) {
                        $("#partial_encuesta").html(data.msj);
                        mostrarListas();
                    } else
                        mostrarmensaje(2, "Non existe ninguna referencia con el numero ingresado");

                }
            });

        } else
            mostrarmensaje(4, "Ingrese un numero de Examen correcto");
    }
    function borrarEncuesta() {
        var examen = $("#num_exam").val();
        var tip = $("#lstParte").val();
        if (examen != "" && examen > 0 && tip != "") {
            $.ajax({
                url: "@Url.Action("BorrarEncuesta", "Herramientas")",
                data: { examen: examen, tipo: tip },
                dataType: "json",
                type: "POST",
                error: function () {
                    mostrarmensaje(4, "Ocurrio un error con el procesamiento, vuelva a interntarlo");
                },
                success: function (data) {
                    mostrarmensaje(1, "Se Modifico con exito la encuesta");
                }
            });
        }
        else
            mostrarmensaje(4, "Seleccione un Parte");
    }
   
</script>

<div class="row">
    <div class="col-lg-12">
        <div class="box box-primary">
            <div class="box-header">
                <h2 class="box-title">Actualizacion de Encuesta </h2>
            </div>
            <div class="box-body chart-responsive">

                @using (Html.BeginForm())
                {
                    @Html.AntiForgeryToken()
                    @Html.ValidationSummary(true)
                    <div class="row">

                        <div class="alert" id="msj">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-8 col-sm-3 col-lg-3">
                            <div class="form-group">
                                <label>N° Examen:</label>
                                <input type="number" id="num_exam" placeholder="Número de Examen" class="form-control" />
                            </div>
                        </div>

                        <div class="col-xs-4 col-sm-1 col-lg-1">
                            <div class="form-group">
                                <label></label>
                                <button type="button" class=" btn btn-info " onclick="cargarEncuesta()" id="btncargarEncuesta"><i class="fa fa-search"></i>&nbsp;&nbsp; Buscar&nbsp;&nbsp; </button>

                            </div>
                        </div>
                    </div>
                    <div id="div_partial_encuesta">
                        <div class="row">
                            <div class="col-lg-4">
                                <div id="partial_encuesta">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-6 col-sm-3 col-lg-3">
                                <label>Seleccione Parte</label>
                                <select class="form-control" id="lstParte">
                                    <option value="">- Seleccione la Parte -</option>
                                    <option value="0">Todo </option>
                                    <option value="1">Encuesta </option>
                                    <option value="2">Supervición </option>
                                    <option value="3">Tecnologo </option>
                                </select>
                            </div>
                            <div class="col-xs-3 col-sm-1 col-lg-1">
                                <div class="form-group">
                                    <label></label>
                                    <button type="button" class=" btn btn-danger " onclick="borrarEncuesta()"><i class="fa fa-trash"></i>&nbsp;&nbsp;Borrar</button>
                                </div>
                            </div>
                        </div>
                    </div>               
                }

            </div>
        </div>
    </div>
</div>
